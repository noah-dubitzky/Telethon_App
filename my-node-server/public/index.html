<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time HTTP Request Listener</title>
</head>
<body>
    <h1>HTTP Request Listener</h1>
    <p>Last received message will be displayed below in real-time:</p>
    <div id="message">
        <pre>No messages received yet.</pre>
    </div>

    <img id="image" alt="description of image" width="200" height="200">

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="scripts/jquery-3.0.0.min.js"></script>
    <script>
        const socket = io();

        // Listen for 'updateMessage' events from the server
        socket.on('updateMessage', (data) => {
            window.alert(JSON.stringify(data));
            document.getElementById('message').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';

            $.post({
                url: "/messages",           // relative to your Express server
                data: JSON.stringify(data),
                contentType: "application/json",  // tell Express we’re sending JSON
                success: function (data) {
                    console.log("✅ POST success:", data);
                    alert("Message inserted: " + JSON.stringify(data, null, 2));
                },
                error: function (xhr) {
                    console.error("❌ POST failed:", xhr.responseText);
                    alert("Error: " + xhr.responseText);
                }
            });
        });

        // Listen for 'updateImage' events from the server
        socket.on('updateImage', (data) => {
            var myImage = $("#image");
            myImage.attr('src', JSON.stringify(data, null, 2)); // Update the src attribute JSON.stringify(data, null, 2);
            alert('change the file path where the images are stored, go to line 34 of uploadHandler.js');
        });
    </script>
</body>
</html>