<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time HTTP Request Listener</title>
</head>
<body>
    <h1>HTTP Request Listener</h1>
    <p>Last received message will be displayed below in real-time:</p>
    <div id="message">
        <pre>No messages received yet.</pre>
    </div>

    <img id="image" alt="description of image" width="200" height="200">
    <video id="video" style="max-width:480px; display:none;" controls></video>

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="scripts/jquery-3.0.0.min.js"></script>
    <script>
        const socket = io();

        // Listen for 'updateMessage' events from the server
        socket.on('updateMessage', (data) => {

            window.alert(JSON.stringify(data));
            document.getElementById('message').innerHTML = '<pre>' + data.text + '</pre>';

            if (data.media_path) {
                // remove leading "my-node-server/public" if it exists
                const cleanedPath = data.media_path.replace(/^my-node-server[\/\\]public[\/\\]?/, "");

                // If it's an image, update <img>
                if (/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(cleanedPath)) {
                    $("#image").attr("src", "/" + cleanedPath).show();
                }else if (/\.(mp4|webm|ogg|mov)$/i.test(cleanedPath)) {
                    $("#video").attr("src", "/" + cleanedPath).show();
                }
            }

        });

        $.get("/messages/senders", function (data) {
          console.log("✅ Success:", data);
          console.log(JSON.stringify(data, null, 2));
        }).fail(function (xhr) {
          console.error("❌ Error:", xhr.responseText);
          alert("Error: " + xhr.responseText);
        });

    </script>
</body>
</html>